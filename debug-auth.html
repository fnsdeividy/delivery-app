<!DOCTYPE html>
<html>
<head>
    <title>Debug Auth</title>
</head>
<body>
    <h1>Debug de Autenticação</h1>
    <div id="output"></div>
    
    <script>
        function debugAuth() {
            const output = document.getElementById('output');
            
            // Verificar localStorage
            const token = localStorage.getItem('cardapio_token');
            output.innerHTML += '<h2>Token no localStorage:</h2>';
            output.innerHTML += token ? `<p>Token encontrado: ${token.substring(0, 50)}...</p>` : '<p>❌ Token não encontrado</p>';
            
            // Verificar cookies
            const cookies = document.cookie.split(';');
            const tokenCookie = cookies.find(c => c.trim().startsWith('cardapio_token='));
            output.innerHTML += '<h2>Token nos cookies:</h2>';
            output.innerHTML += tokenCookie ? `<p>Token encontrado: ${tokenCookie.substring(15, 65)}...</p>` : '<p>❌ Token não encontrado nos cookies</p>';
            
            // Verificar usuário
            const user = localStorage.getItem('user');
            output.innerHTML += '<h2>Usuário no localStorage:</h2>';
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    output.innerHTML += `<p>✅ Usuário: ${userData.email} (${userData.role})</p>`;
                    output.innerHTML += `<p>Loja atual: ${userData.currentStoreSlug || 'Nenhuma'}</p>`;
                } catch (e) {
                    output.innerHTML += '<p>❌ Erro ao parsear usuário</p>';
                }
            } else {
                output.innerHTML += '<p>❌ Usuário não encontrado</p>';
            }
            
            // Testar requisição
            if (token) {
                output.innerHTML += '<h2>Testando requisição:</h2>';
                fetch('http://localhost:3001/api/v1/inventory/store/uziel/summary', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    output.innerHTML += `<p>✅ Resposta da API: ${JSON.stringify(data)}</p>`;
                })
                .catch(error => {
                    output.innerHTML += `<p>❌ Erro na requisição: ${error.message}</p>`;
                });
            }
        }
        
        // Executar quando a página carregar
        window.onload = debugAuth;
    </script>
</body>
</html>